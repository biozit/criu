Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 criu (3.15-1) buster; urgency=medium
 .
   * Fix build failures seen on s390x and arm/aarch64
Author: Adrian Reber <adrian@lisas.de>

---
The information above should follow the Patch Tagging Guidelines, please
checkout http://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: <vendor|upstream|other>, <url of original patch>
Bug: <url in upstream bugtracker>
Bug-Debian: https://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: <no|not-needed|url proving that it has been forwarded>
Reviewed-By: <name and email of someone who approved the patch>
Last-Update: 2021-03-02

--- criu-3.15.orig/criu/plugin.c
+++ criu-3.15/criu/plugin.c
@@ -243,7 +243,11 @@ int cr_plugin_init(int stage)
 		if (len < 3 || strncmp(de->d_name + len - 3, ".so", 3))
 			continue;
 
-		snprintf(path, sizeof(path), "%s/%s", opts.libdir, de->d_name);
+		if (snprintf(path, sizeof(path), "%s/%s", opts.libdir, de->d_name) >=
+		    sizeof(path)) {
+			pr_err("Unable to build plugin path\n");
+			goto err;
+		}
 
 		if (cr_lib_load(stage, path))
 			goto err;
--- criu-3.15.orig/criu/sk-unix.c
+++ criu-3.15/criu/sk-unix.c
@@ -131,7 +131,8 @@ static struct unix_sk_listen_icon *looku
 static void show_one_unix(char *act, const struct unix_sk_desc *sk)
 {
 	pr_debug("\t%s: ino %u peer_ino %u family %4d type %4d state %2d name %s\n",
-		act, sk->sd.ino, sk->peer_ino, sk->sd.family, sk->type, sk->state, sk->name);
+		act, sk->sd.ino, sk->peer_ino, sk->sd.family, sk->type, sk->state,
+		sk->name ? : "null");
 
 	if (sk->nr_icons) {
 		int i;
--- criu-3.15.orig/include/common/bug.h
+++ criu-3.15/include/common/bug.h
@@ -24,6 +24,7 @@
 			pr_err("BUG at %s:%d\n", __FILE__, __LINE__);			\
 			__raise();							\
 			*(volatile unsigned long *)NULL = 0xdead0000 + __LINE__;	\
+			__builtin_unreachable();					\
 		}									\
 	} while (0)
 #else
